<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Comp C Java IDE</title>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --sidebar-bg: #252526;
            --sidebar-text: #CCCCCC;
            --sidebar-hover: #2A2D2E;
            --sidebar-active: #37373D;
            --editor-bg: #1E1E1E;
            --editor-text: #D4D4D4;
            --toolbar-bg: #333333;
            --button-bg: #0E639C;
            --button-hover: #1177BB;
            --output-bg: #1E1E1E;
            --border-color: #474747;
            --accent-color: #569CD6;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            height: 100vh;
            display: flex;
            color: var(--editor-text);
            background: var(--editor-bg);
        }

        /* Sidebar */
        #sidebar {
            width: 280px;
            background: var(--sidebar-bg);
            display: flex;
            flex-direction: column;
            border-right: 1px solid var(--border-color);
        }

        #sidebar-header {
            padding: 12px 16px;
            font-weight: 600;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        
        .file-item {
            padding: 6px 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }

        .file-item:hover {
            background: var(--sidebar-hover);
        }

        .file-item.active {
            background: var(--sidebar-active);
        }

        .file-icon {
            color: #569CD6;
        }

        .file-actions {
            margin-left: auto;
            display: none;
        }

        .file-item:hover .file-actions {
            display: flex;
            gap: 4px;
        }

        .file-action {
    background: none;
    border: none;
    color: var(--sidebar-text);
    cursor: pointer;
    font-size: 12px;
    opacity: 0.7;
    padding: 2px;
    transition: 0.2s;
}

.file-action:hover {
    opacity: 1;
    background: var(--sidebar-hover);
    border-radius: 4px;
}

        /* Main Content */
        #main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        #tab-bar {
            background: var(--editor-bg);
            display: flex;
            border-bottom: 1px solid var(--border-color);
            height: 35px;
        }

        .tab {
            padding: 0 16px;
            display: flex;
            align-items: center;
            font-size: 13px;
            border-right: 1px solid var(--border-color);
            cursor: pointer;
            position: relative;
        }

        .tab.active {
            background: var(--editor-bg);
        }

        .tab-close {
            margin-left: 8px;
            opacity: 0;
        }

        .tab:hover .tab-close {
            opacity: 0.7;
        }

        .tab:hover .tab-close:hover {
            opacity: 1;
        }

        #editor-container {
            flex: 1;
            position: relative;
        }

        #editor {
            position: absolute;
            top: 0;
            right: 0;
            bottom: 0;
            left: 0;
            font-family: 'Fira Code', monospace;
            font-size: 14px;
            line-height: 1.5;
        }

        /* Toolbar */
        #toolbar {
            padding: 8px 12px;
            background: var(--toolbar-bg);
            display: flex;
            gap: 8px;
            border-bottom: 1px solid var(--border-color);
        }

        button {
            padding: 6px 12px;
            background: var(--button-bg);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-family: 'Inter', sans-serif;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.2s;
        }

        button:hover {
            background: var(--button-hover);
        }

        button.secondary {
            background: none;
            color: var(--editor-text);
            border: 1px solid var(--border-color);
        }

        button.secondary:hover {
            background: rgba(255,255,255,0.1);
        }

        #filename-input {
            padding: 6px 12px;
            background: rgba(255,255,255,0.1);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            color: var(--editor-text);
            font-family: 'Inter', sans-serif;
            flex: 1;
            max-width: 200px;
        }

        /* Output */
        #output-container {
            height: 180px;
            background: var(--output-bg);
            border-top: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
        }

        #output-tabs {
            display: flex;
            background: var(--toolbar-bg);
            padding: 0 12px;
        }

        .output-tab {
            padding: 8px 12px;
            font-size: 12px;
            cursor: pointer;
            border-bottom: 2px solid transparent;
        }

        .output-tab.active {
            border-bottom: 2px solid var(--accent-color);
        }

        #output {
            flex: 1;
            padding: 12px;
            overflow-y: auto;
            font-family: 'Fira Code', monospace;
            font-size: 13px;
            white-space: pre-wrap;
        }

        /* Status Bar */
        #status-bar {
            padding: 4px 12px;
            background: var(--button-bg);
            font-size: 12px;
            display: flex;
            justify-content: space-between;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Context Menu */
        .context-menu {
            position: absolute;
            background: var(--sidebar-bg);
            border: 1px solid var(--border-color);
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
            z-index: 100;
            display: none;
        }

        .context-menu-item {
            padding: 8px 16px;
            cursor: pointer;
            font-size: 13px;
        }

        .context-menu-item:hover {
            background: var(--sidebar-hover);
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <div id="sidebar">
        <div id="sidebar-header">
            <span>EXPLORER</span>
            <div>
                <button class="file-action" id="new-file-btn" title="New File">+</button>
            </div>
        </div>
        <div id="file-explorer">
            <!-- Files will be added here dynamically -->
        </div>
    </div>

    <!-- Main Content -->
    <div id="main-content">
        <div id="tab-bar">
            <!-- Tabs will be added here dynamically -->
        </div>
        
        <div id="toolbar">
            <button id="run-btn">
                <span>▶</span>
                <span>Run</span>
            </button>
            <button id="save-btn" class="secondary">
                <span>💾</span>
                <span>Save</span>
            </button>
            <input type="text" id="filename-input" placeholder="NewFile.java">
        </div>
        
        <div id="editor-container">
            <div id="editor">// Select a file from the sidebar</div>
        </div>
        
        <div id="output-container">
            <div id="output-tabs">
                <div class="output-tab active">OUTPUT</div>
                <div class="output-tab">PROBLEMS</div>
                <div class="output-tab">TERMINAL</div>
            </div>
            <pre id="output">Ready</pre>
        </div>

        <div id="status-bar">
            <div class="status-item">
                <span>Java</span>
            </div>
            <div class="status-item">
                <span id="line-info">Ln 1, Col 1</span>
            </div>
        </div>
    </div>

    <!-- Context Menu -->
    <div class="context-menu" id="file-context-menu">
        <div class="context-menu-item" data-action="rename">Rename</div>
        <div class="context-menu-item" data-action="delete">Delete</div>
    </div>

    <!-- Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/ace.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/mode-java.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/theme-monokai.js"></script>
    <script>
        // ========== STATE MANAGEMENT ==========
        const state = {
            files: {
                "Main.java": {
                    content: `public class Main {
    public static void main(String[] args) {
        System.out.println("Hello, Comp C!");
    }
}`,
                    open: true,
                    active: true
                },
                "MultilevelInheritanceDemo.java": {
                    content: `class Animal {
    void eat() { System.out.println("Eating..."); }
}

class Dog extends Animal {
    void bark() { System.out.println("Barking..."); }
}

class Puppy extends Dog {
    void weep() { System.out.println("Weeping..."); }
}

public class MultilevelInheritanceDemo {
    public static void main(String[] args) {
        Puppy p = new Puppy();
        p.eat();   // from Animal
        p.bark();  // from Dog
        p.weep();  // from Puppy
    }
}`,
                    open: false,
                    active: false
                }
            },
            currentFile: "Main.java",
            output: ""
        };

        // ========== DOM ELEMENTS ==========
        const elements = {
            sidebar: document.getElementById('sidebar'),
            fileExplorer: document.getElementById('file-explorer'),
            tabBar: document.getElementById('tab-bar'),
            editor: ace.edit("editor"),
            editorContainer: document.getElementById('editor-container'),
            output: document.getElementById('output'),
            runBtn: document.getElementById('run-btn'),
            saveBtn: document.getElementById('save-btn'),
            newFileBtn: document.getElementById('new-file-btn'),
            filenameInput: document.getElementById('filename-input'),
            fileContextMenu: document.getElementById('file-context-menu'),
            lineInfo: document.getElementById('line-info')
        };

        // ========== EDITOR SETUP ==========
        elements.editor.setTheme("ace/theme/monokai");
        elements.editor.session.setMode("ace/mode/java");
        elements.editor.setOptions({
            fontSize: "14px",
            fontFamily: "'Fira Code', monospace",
            enableBasicAutocompletion: true,
            enableLiveAutocompletion: true,
            showPrintMargin: false,
            highlightActiveLine: true,
            tabSize: 4
        });

        // Update cursor position
        elements.editor.on('changeCursor', () => {
            const cursor = elements.editor.selection.getCursor();
            elements.lineInfo.textContent = `Ln ${cursor.row + 1}, Col ${cursor.column + 1}`;
        });

        // ========== FILE MANAGEMENT ==========
        function renderFileExplorer() {
            elements.fileExplorer.innerHTML = '';
            Object.keys(state.files).forEach(filename => {
                const fileItem = document.createElement('div');
                fileItem.className = `file-item ${state.currentFile === filename ? 'active' : ''}`;
                fileItem.dataset.file = filename;
                
                fileItem.innerHTML = `
    <span class="file-icon">📄</span>
    <span class="file-name">${filename}</span>
    <div class="file-actions">
        <button class="file-action rename-btn" title="Rename">✏️</button>
        <button class="file-action delete-btn" title="Delete">🗑️</button>
    </div>
`;

fileItem.addEventListener('click', (e) => {
    if (!e.target.closest('.file-action')) {
        openFile(filename);
    }
});

// Handle Rename
fileItem.querySelector('.rename-btn').addEventListener('click', (e) => {
    e.stopPropagation();
    const newName = prompt("Rename file:", filename);
    if (newName && newName.trim() !== '') {
        renameFile(filename, newName);
    }
});

// Handle Delete
fileItem.querySelector('.delete-btn').addEventListener('click', (e) => {
    e.stopPropagation();
    deleteFile(filename);
});


                elements.fileExplorer.appendChild(fileItem);
            });
        }

        function renderTabs() {
            elements.tabBar.innerHTML = '';
            Object.keys(state.files).forEach(filename => {
                if (state.files[filename].open) {
                    const tab = document.createElement('div');
                    tab.className = `tab ${state.currentFile === filename ? 'active' : ''}`;
                    tab.dataset.file = filename;
                    
                    tab.innerHTML = `
                        <span>${filename}</span>
                        <span class="tab-close" data-action="close">✕</span>
                    `;
                    
                    tab.addEventListener('click', () => openFile(filename));
                    
                    const closeBtn = tab.querySelector('.tab-close');
                    closeBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        closeFile(filename);
                    });
                    
                    elements.tabBar.appendChild(tab);
                }
            });
        }

        function openFile(filename) {
            if (!state.files[filename]) return;
            
            // Update state
            state.currentFile = filename;
            state.files[filename].open = true;
            state.files[filename].active = true;
            
            // Update other files
            Object.keys(state.files).forEach(f => {
                if (f !== filename) {
                    state.files[f].active = false;
                }
            });
            
            // Update editor
            elements.editor.setValue(state.files[filename].content);
            elements.editor.clearSelection();
            
            // Render updates
            renderFileExplorer();
            renderTabs();
        }

        function closeFile(filename) {
            if (!state.files[filename] || filename === state.currentFile) return;
            
            state.files[filename].open = false;
            renderTabs();
        }

        function createNewFile() {
            let filename = elements.filenameInput.value.trim();
            if (!filename) return;
            
            if (!filename.endsWith('.java')) {
                filename += '.java';
            }
            
            const className = filename.replace('.java', '');
            
            if (!state.files[filename]) {
                state.files[filename] = {
                    content: `public class ${className} {
    public static void main(String[] args) {
        // Your code here
    }
}`,
                    open: true,
                    active: true
                };
                
                // Update current file and clear input
                state.currentFile = filename;
                elements.filenameInput.value = '';
                
                // Update UI
                renderFileExplorer();
                renderTabs();
                openFile(filename);
            } else {
                alert("File already exists!");
            }
        }

        function saveCurrentFile() {
            if (state.currentFile) {
                state.files[state.currentFile].content = elements.editor.getValue();
                // Visual feedback
                elements.saveBtn.innerHTML = '<span>✓</span><span>Saved</span>';
                setTimeout(() => {
                    elements.saveBtn.innerHTML = '<span>💾</span><span>Save</span>';
                }, 1000);
            }
        }

        function renameFile(oldName, newName) {
    newName = newName.trim();

    if (!newName.endsWith('.java')) {
        alert("Filename must end with '.java'.");
        return;
    }

    if (newName === oldName) return;

    if (state.files[newName]) {
        alert("File with this name already exists.");
        return;
    }

    // Move the file content to new key
    state.files[newName] = { ...state.files[oldName] };
    delete state.files[oldName];

    // Update current file if needed
    if (state.currentFile === oldName) {
        state.currentFile = newName;
        openFile(newName); // important: open the renamed file
    }

    renderFileExplorer();
    renderTabs();
}

        function deleteFile(filename) {
            if (!confirm(`Delete ${filename}?`)) return;
            
            // If the file is open in a tab, close it first
            if (state.files[filename].open) {
                closeFile(filename);
            }
            
            // If it's the current file, switch to another
            if (state.currentFile === filename) {
                const otherFiles = Object.keys(state.files).filter(f => f !== filename);
                if (otherFiles.length > 0) {
                    openFile(otherFiles[0]);
                } else {
                    state.currentFile = null;
                    elements.editor.setValue("");
                }
            }
            
            // Remove from state
            delete state.files[filename];
            
            // Update UI
            renderFileExplorer()

            
            renderTabs();
        }

        // ========== CONTEXT MENU ==========
        function showContextMenu(event, filename) {
    event.preventDefault();
    
    elements.fileContextMenu.style.display = 'block';
    elements.fileContextMenu.style.left = `${event.pageX}px`;
    elements.fileContextMenu.style.top = `${event.pageY}px`;

    const menuItems = elements.fileContextMenu.querySelectorAll('.context-menu-item');
    menuItems.forEach(item => {
        item.onclick = (e) => {
            e.stopPropagation();
            const action = item.dataset.action;

            if (action === 'rename') {
                const newName = prompt("Rename file:", filename);
                if (newName && newName !== filename) {
                    const trimmed = newName.trim();
                    if (!trimmed.endsWith('.java')) {
                        alert("⚠️ File name must end with `.java`.");
                    } else if (state.files[trimmed]) {
                        alert("❌ File already exists.");
                    } else {
                        renameFile(filename, trimmed);
                    }
                }
            } else if (action === 'delete') {
                deleteFile(filename);
            }

            elements.fileContextMenu.style.display = 'none';
        };
    });

    document.addEventListener('click', hideContextMenu);
}

function hideContextMenu() {
    elements.fileContextMenu.style.display = 'none';
    document.removeEventListener('click', hideContextMenu);
}

            

        // ========== CODE EXECUTION ==========
        async function runCode() {
            if (!state.currentFile) return;
            
            // Save current file
            saveCurrentFile();
            
            // Get code
            const code = state.files[state.currentFile].content;
            elements.output.textContent = "⏳ Running...";
            
            try {
                const response = await fetch("https://compc-4.onrender.com/run", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ code })
                });
                
                const data = await response.json();
                elements.output.textContent = data.output || "❌ No output";
                state.output = data.output || "";
            } catch (err) {
                elements.output.textContent = `❌ Error: ${err.message}`;
                state.output = `Error: ${err.message}`;
            }
        }

        // ========== EVENT LISTENERS ==========
        elements.runBtn.addEventListener('click', runCode);
        elements.saveBtn.addEventListener('click', saveCurrentFile);
        elements.newFileBtn.addEventListener('click', createNewFile);
        elements.filenameInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                createNewFile();
            }
        });

        // Close context menu when clicking outside
        document.addEventListener('click', () => {
            if (elements.fileContextMenu.style.display === 'block') {
                elements.fileContextMenu.style.display = 'none';
            }
        });

        // Initialize
        renderFileExplorer();
        renderTabs();
        if (state.currentFile) {
            openFile(state.currentFile);
        }
    </script>
</body>
</html>